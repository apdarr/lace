<%= form_with(model: plan, class: "contents", data: { controller: "plan-form" }) do |form| %>
  <% if plan.errors.any? %>
    <div class="rounded-md border border-red-200 bg-red-50 p-4 mb-6">
      <h2 class="text-sm font-semibold text-red-700 mb-2"><%= pluralize(plan.errors.count, "error") %> prevented saving:</h2>
      <ul class="list-disc pl-5 space-y-1 text-sm text-red-600">
        <% plan.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="space-y-6">
    <div class="form-field">
      <%= form.label :plan_type, class: "form-label" %>
      <%= form.select :plan_type,
                      [
                        ['Use Template Plan (Recommended)', 'template'],
                        ['Create Custom Plan (Advanced)', 'custom']
                      ],
                      { selected: plan.plan_type || 'template' },
                      { class: "form-input cursor-pointer", data: { action: "change->plan-form#togglePlanType" } } %>
      <p class="text-xs text-slate-500 mt-1">Template uses a proven schedule. Custom lets you build or upload and extract.</p>
    </div>

    <div class="form-field">
      <%= form.label :length, class: "form-label" %>
      <%= form.number_field :length, class: "form-input" %>
    </div>

    <div class="form-field">
      <%= form.label :race_date, class: "form-label" %>
      <%= form.date_field :race_date, class: "form-input" %>
    </div>

    <div class="form-field">
      <div class="flex items-center gap-3">
        <%= form.check_box :webhook_enabled, class: "h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500" %>
        <%= form.label :webhook_enabled, "Enable Strava Activity Sync", class: "text-sm font-medium text-slate-700 cursor-pointer" %>
      </div>
      <p class="text-xs text-slate-500 mt-1">Automatically sync new Strava activities and match them to workouts in this plan</p>
    </div>

    <div data-plan-form-target="photosSection" style="display: none;" class="space-y-3">
      <div class="form-field">
        <%= form.label :photos, "Upload Training Plan Photos", class: "form-label" %>
        <%= form.file_field :photos, multiple: true, accept: "image/*", class: "form-input" %>
        <p class="text-xs text-slate-500 mt-1">Upload clear images of a plan. We'll parse workouts automatically.</p>
      </div>
    </div>

    <div class="pt-2">
      <%= form.submit class: "btn-primary w-full justify-center" %>
    </div>
  </div>
<% end %>
